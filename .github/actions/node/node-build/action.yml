name: 'Node Build and Test'
inputs:
  node-version:
    required: true

runs:
  using: "composite"
  steps:
    - name: SetUp Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ inputs.node-version }}

    - name: Install dependencies
      shell: bash
      run: npm install

    - name: Test
      shell: bash
      run: npm run test

    - name: Version Markers
      shell: bash
      run: |

        sed -i 's/__REF_TYPE__/${{github.ref_type}}/g' ./src/changelog.html
        sed -i 's/__REF_NAME__/"${{github.ref_name}}"/g' ./src/changelog.html
        sed -i 's/__LAST_COMMIT__/${{github.sha}}/g' ./src/changelog.html
        sed -i 's/__BUILD_DATE__/${{ github.event.repository.updated_at}}/g' ./src/changelog.html

        echo ${{github.sha}} > ./src/version.txt

        git log --format="%ad - [%h]: %s" --date=format:"%d/%m/%Y %H:%M:%S" --max-count=5 --abbrev-commit >> ./src/changelog.html
